{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Infrastructure Density vs. Commuter Uptake",
  "description": "Full-width scatter plot showing relationship between public transport infrastructure density and % using PT across Australian states, with best-fit line.",
  "data": {
    "url": "data/pt-infra-density.csv"
  },
  "transform": [
    {
      "lookup": "state_name",
      "from": {
        "data": {
          "values": [
            {"state_name": "Victoria", "pt_share": 4.4},
            {"state_name": "Queensland", "pt_share": 4.1},
            {"state_name": "South Australia", "pt_share": 7.4},
            {"state_name": "Western Australia", "pt_share": 5.3}
          ]
        },
        "key": "state_name",
        "fields": ["pt_share"]
      }
    },
    {
      "calculate": "toNumber(datum.infra_per_100k)",
      "as": "xval"
    },
    {
      "calculate": "toNumber(datum.pt_share)",
      "as": "yval"
    },
    {
      "filter": "isValid(datum.xval) && isValid(datum.yval)"
    }
  ],
  "width": "container",       
  "height": 350,               
  "layer": [
    {
      "mark": {
        "type": "point",
        "filled": true,
        "size": 200
      },
      "encoding": {
        "x": {
          "field": "xval",
          "type": "quantitative",
          "title": "Stops/Stations per 100,000 Residents",
          "scale": {"domain": [200, 550]}
        },
        "y": {
          "field": "yval",
          "type": "quantitative",
          "title": "% of People Using Public Transport",
          "scale": {"domain": [3, 8]}
        },
        "color": {"field": "state_name", "type": "nominal", "title": "State"},
        "tooltip": [
          {"field": "state_name", "title": "State"},
          {"field": "xval", "title": "Stops per 100k"},
          {"field": "yval", "title": "% Using PT"}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "dy": -15,
        "fontSize": 12,
        "fontWeight": "bold"
      },
      "encoding": {
        "text": {"field": "state_name"},
        "x": {"field": "xval", "type": "quantitative"},
        "y": {"field": "yval", "type": "quantitative"},
        "color": {"field": "state_name", "type": "nominal"}
      }
    },
    {
      "transform": [
        {"regression": "yval", "on": "xval"}
      ],
      "mark": {
        "type": "line",
        "color": "gray",
        "strokeDash": [5, 5],
        "strokeWidth": 2
      },
      "encoding": {
        "x": {"field": "xval", "type": "quantitative"},
        "y": {"field": "yval", "type": "quantitative"}
      }
    }
  ],
  "config": {
    "background": "white",
    "axis": {
      "labelFont": "Arial",
      "titleFont": "Arial",
      "titleFontSize": 13,
      "labelFontSize": 11
    },
    "legend": {"orient": "bottom"}
  }
}
