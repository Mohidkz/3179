<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PT Line ‚Äî How Australians Commute (ABS 2021 + State Sources)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Muhammad Mohid Khanzada (ID: 33891095)">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <style>
    :root{
      /* Transit theme (light) */
      --bg:#f6f8fb; --card:#ffffff; --ink:#0b1220; --muted:#526071; --grid:#d9e1ea;
      --rail:#0b5fff;  /* train */
      --bus:#16a34a;   /* bus  */
      --tram:#f59e0b;  /* tram */
      --ferry:#14b8a6; /* ferry */
      --accent:#7c3aed;
      --ocean:#e6f1fb;
      --pill-bg:#eef2f7; --pill-fg:#0b1220; --pill-br:#cfd7e3;
    }
    @media (prefers-color-scheme: dark){
      :root{
        /* Transit theme (dark) */
        --bg:#0b1220; --card:#0f172a; --ink:#e6eef9; --muted:#b6c2d0; --grid:#263449;
        --rail:#7aa7ff; --bus:#4ade80; --tram:#fbbf24; --ferry:#5eead4; --accent:#a78bfa;
        --ocean:#0c2135;
        --pill-bg:#152238; --pill-fg:#e6eef9; --pill-br:#2b3b53;
      }
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,Segoe UI,Roboto,Arial,sans-serif;scroll-behavior:smooth}
    .wrap{max-width:1080px;margin:0 auto;padding:24px 16px 56px}
    header{margin-bottom:14px;position:relative}
    h1{margin:0 0 8px;font-size:28px;letter-spacing:.2px}
    .lede{color:var(--muted);max-width:72ch;margin:0 0 12px;font-size:16px}
    .station{background:var(--card);border:1px solid var(--grid);border-radius:16px;padding:18px 18px 14px;margin:18px 0}
    .station h2{margin:0 0 8px;font-size:20px;display:flex;gap:8px;align-items:center}
    .grid12{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    figure{margin:8px 0 2px}
    .span6{grid-column:span 6}.span12{grid-column:span 12}
    .vis{width:100%}
    figcaption{color:var(--muted);font-size:14px;margin-top:8px;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .line{position:relative;display:flex;gap:18px;align-items:center;overflow:hidden;padding:14px 12px;background:var(--card);border:1px solid var(--grid);border-radius:14px}
    .line:before{content:"";position:absolute;left:48px;right:12px;top:50%;height:4px;background:var(--rail);transform:translateY(-50%);border-radius:999px}
    .stop{position:relative;display:flex;align-items:center;gap:10px;z-index:1}
    .badge{width:26px;height:26px;border-radius:50%;display:grid;place-items:center;background:var(--rail);color:#fff;font-weight:700;font-size:12px;border:2px solid #fff;box-shadow:0 0 0 2px var(--rail)}
    .label{font-size:14px}.label small{color:var(--muted)}
    .line .stop:nth-child(3) .badge{background:var(--bus);box-shadow:0 0 0 2px var(--bus)}
    .line .stop:nth-child(4) .badge{background:var(--tram);box-shadow:0 0 0 2px var(--tram)}
    .line .stop:nth-child(5) .badge{background:var(--ferry);box-shadow:0 0 0 2px var(--ferry)}
    .line .stop:last-child .badge{background:var(--accent);color:#121212;box-shadow:0 0 0 2px var(--accent)}
    .hr{height:1px;background:var(--grid);margin:18px 0}
    .next{display:inline-flex;align-items:center;gap:6px;margin-top:10px;font-weight:700;color:var(--rail);text-decoration:none}
    .next:hover{text-decoration:underline}
    details.footer{margin-top:10px;font-size:13px;color:var(--muted)}
    .note{font-size:13px;color:var(--muted)}
    .body{color:var(--muted);max-width:75ch;margin:6px 0 2px}
    .jsonbtn{
      display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--pill-br);
      background:var(--pill-bg); color:var(--pill-fg); font-size:12px; text-decoration:none; font-weight:600; line-height:1;
    }
    .jsonbtn:hover{filter:brightness(1.05)}
    .jsonbtn:focus{outline:3px solid color-mix(in oklab, var(--rail), transparent 60%); outline-offset:2px}
    /* subtle ‚Äúroute striping‚Äù under header */
    .route-bg{position:absolute;inset:auto 0 -10px 0;height:8px;background:
      linear-gradient(90deg,var(--rail) 0 25%, var(--bus) 25% 50%, var(--tram) 50% 75%, var(--ferry) 75% 100%);
      border-radius:99px;opacity:.25}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>PT Line ‚Äî How Australians Commute</h1>
      <p class="lede">
        A transport-themed storyline: snapshot (ABS 2021 MTWP), geography, national mode split, infrastructure vs uptake, plus <strong>operational views</strong> ‚Äî Victoria monthly patronage and Adelaide smartcard validations.
      </p>
      <div class="line" aria-label="Journey steps">
        <div class="stop"><div class="badge">1</div><div class="label">Compare<br><small>% using PT</small></div></div>
        <div class="stop"><div class="badge">2</div><div class="label">Map<br><small>Where uptake concentrates</small></div></div>
        <div class="stop"><div class="badge">3</div><div class="label">Modes<br><small>National split</small></div></div>
        <div class="stop"><div class="badge">4</div><div class="label">Infra ‚Üî Uptake<br><small>Access vs share</small></div></div>
        <div class="stop"><div class="badge">5</div><div class="label">Ops: VIC & SA<br><small>Monthly use & taps</small></div></div>
        <div class="stop"><div class="badge">6</div><div class="label">Takeaways<br><small>What to remember</small></div></div>
      </div>
      <div class="route-bg" aria-hidden="true"></div>
    </header>

    <!-- Station 1 -->
    <section class="station" id="st1">
      <h2>üöá Station 1 ‚Äî State Comparison</h2>
      <p class="body">
        Snapshot: what share of employed people used public transport to get to work in 2021? The lollipop ranks the states; the diverging bars show how far each sits above/below the national average.
      </p>
      <div class="grid12">
        <figure class="span6">
          <div id="vis-lollipop" class="vis" aria-label="Lollipop ranking"></div>
          <figcaption>
            <span>Lollipop ranking ‚Äî % of employed commuters using PT (ABS 2021 MTWP).</span>
            <a class="jsonbtn" href="spec/lollipop.json">View JSON</a>
          </figcaption>
        </figure>
        <figure class="span6">
          <div id="vis-diverge" class="vis" aria-label="Deviation from national average"></div>
          <figcaption>
            <span>Deviation from national average (percentage points).</span>
            <a class="jsonbtn" href="spec/diverge.json">View JSON</a>
          </figcaption>
        </figure>
      </div>
      <a class="next" href="#st2">Next stop ‚Üí Map</a>
    </section>

    <!-- Station 2 -->
    <section class="station" id="st2">
      <h2>üó∫Ô∏è Station 2 ‚Äî Geography & Magnitude</h2>
      <p class="body">
        Uptake clusters in the big, rail-served metros along the coast. The choropleth shows geography; the waffle multiples translate percentages into people: ‚Äúout of 100 workers, how many used PT?‚Äù
      </p>
      <div class="grid12">
        <figure class="span12">
          <div id="vis-map" class="vis" aria-label="Choropleth map"></div>
          <figcaption>
            <span>% using PT by state (same metric as Station 1).</span>
            <a class="jsonbtn" href="spec/au-pt-map.json">View JSON</a>
          </figcaption>
        </figure>
        <figure class="span12">
          <div id="vis-waffles" class="vis" aria-label="Waffle multiples"></div>
          <figcaption>
            <span>Waffle small-multiples ‚Äî out of 100 employed people, how many used PT?</span>
            <a class="jsonbtn" href="spec/waffles.json">View JSON</a>
          </figcaption>
        </figure>
      </div>
      <a class="next" href="#st3">Next stop ‚Üí Modes</a>
    </section>

    <!-- Station 3 -->
    <section class="station" id="st3">
      <h2>üöâ Station 3 ‚Äî What We Rode (National)</h2>
      <p class="body">Trains take the biggest slice nationally, followed by buses; trams and ferries are smaller but vital in specific cities.</p>
      <figure>
        <div id="vis-pie" class="vis" aria-label="Donut mode split"></div>
        <figcaption>
          <span>ABS 2021 MTWP national mode split.</span>
          <a class="jsonbtn" href="spec/pie.json">View JSON</a>
        </figcaption>
      </figure>
      <a class="next" href="#st4">Next stop ‚Üí Infrastructure & Uptake</a>
    </section>

    <!-- Station 4 -->
    <section class="station" id="st4">
      <h2>üß≠ Station 4 ‚Äî Does Infrastructure Density Relate to Uptake?</h2>
      <p class="body">Access matters: states with more stops/stations per 100k people generally show higher PT shares. The dashed line summarises the association (descriptive, not causal).</p>
      <figure>
        <div id="vis-scatter" class="vis" aria-label="Scatter infra vs uptake"></div>
        <figcaption>
          <span>Stops filtered (location_type 0/blank/1), deduped by <code>COALESCE(parent_station, stop_id)</code>; scaled by ABS ERP √ó 100,000.</span>
          <a class="jsonbtn" href="spec/scatter.json">View JSON</a>
        </figcaption>
      </figure>
      <figure>
        <div id="vis-infra" class="vis" aria-label="Infra ranking"></div>
        <figcaption>
          <span>Stops/stations per 100k (ranking) ‚Äî availability proxy.</span>
          <a class="jsonbtn" href="spec/infra-bars.json">View JSON</a>
        </figcaption>
      </figure>
      <a class="next" href="#st5">Next stop ‚Üí VIC & SA operations</a>
    </section>

    <!-- Station 5 -->
    <section class="station" id="st5">
      <h2>üöå Station 5 ‚Äî Operational Views: VIC & SA</h2>
      <p class="body"><strong>Victoria:</strong> monthly boardings show the pandemic shock and recovery by mode. <strong>Adelaide:</strong> smartcard taps (band-floor counts) reveal a bus-led mix and a weekday rhythm in early 2021.</p>
      <figure>
        <div id="vis-vic-lines" class="vis" aria-label="Victoria monthly patronage"></div>
        <figcaption>
          <span><strong>Victoria monthly patronage (2018‚Äì2025)</strong> ‚Äî Metropolitan train, tram, bus.</span>
          <a class="jsonbtn" href="spec/vic-lines.json">View JSON</a>
        </figcaption>
      </figure>
      <div class="grid12">
        <figure class="span6">
          <div id="vis-sa-stacked" class="vis" aria-label="Adelaide validations by mode (share)"></div>
          <figcaption>
            <span><strong>Adelaide mode mix (2021 Q1)</strong> ‚Äî 100% stacked: each bar shows the <em>share</em> of taps by mode per month (Bus / Train / Tram).</span>
            <a class="jsonbtn" href="spec/sa-stacked.json">View JSON</a>
          </figcaption>
        </figure>
        <figure class="span6">
          <div id="vis-sa-heat" class="vis" aria-label="Adelaide weekday heatmap (weeks W1‚ÄìW13)"></div>
          <figcaption>
            <span><strong>Adelaide taps by weekday</strong> ‚Äî columns are <em>weeks W1‚ÄìW13</em> (Jan‚ÄìMar 2021), rows are <em>Mon‚ÄìSun</em>; darker = more taps.</span>
            <a class="jsonbtn" href="spec/sa-heat.json">View JSON</a>
          </figcaption>
        </figure>
      </div>
      <a class="next" href="#st6">Final stop ‚Üí Takeaways</a>
    </section>

    <div class="hr" role="separator"></div>

    <!-- Station 6 -->
    <section class="station" id="st6">
      <h2>‚úÖ Station 6 ‚Äî Key Takeaways</h2>
      <ul class="note" style="margin:6px 0 0 18px">
        <li>States with large rail-served metros show higher PT shares; dispersed regions trail.</li>
        <li>Trains lead nationally; buses follow; trams/ferries are city-specific.</li>
        <li>Higher stop density tends to align with higher PT uptake (association).</li>
        <li>VIC recovery is visible in monthly patronage; SA shows a weekday-heavy rhythm and bus-led mix.</li>
        <li><strong>Innovation:</strong> Census snapshot + GTFS-derived infrastructure density + two operational feeds in one storyline.</li>
      </ul>

      <details class="footer">
        <summary>Sources & licences</summary>
        <ul>
          <li>ABS Census 2021 ‚Äî Method of Travel to Work (MTWP); ABS ERP Dec-2021 (attribution required).</li>
          <li>Natural Earth Admin-1 (public domain) ‚Üí TopoJSON.</li>
          <li>GTFS stops: VIC (DataVic), QLD (Translink), SA (data.sa.gov.au), WA (Transperth).</li>
          <li>Victoria monthly patronage: Vic DTP ‚ÄúMonthly public transport patronage by mode‚Äù (CSV).</li>
          <li>Adelaide Metrocard validations 2021 Q1 (CC BY), band floors.</li>
        </ul>
        <p class="note">Hosted on GitHub Pages. All <a href="spec/">Vega-Lite JSON specs</a> and <a href="data/">data files</a> are in this repo.</p>
      </details>

      <p class="note" style="margin-top:12px">
        <strong>Author:</strong> Muhammad Mohid Khanzada (ID: 33891095) ‚Ä¢
        <strong>Last updated:</strong> <span id="updated"></span>
      </p>
      <a class="next" href="#st1">Back to Station 1 ‚Üë</a>
    </section>
  </div>

  <script>
    // Inject a transit-themed Vega-Lite config so axes/titles are readable in both light and dark modes.
    const isDark = matchMedia('(prefers-color-scheme: dark)').matches;
    const ui = {
      text:       getComputedStyle(document.documentElement).getPropertyValue('--ink').trim() || (isDark ? '#e6eef9' : '#0b1220'),
      muted:      getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() || (isDark ? '#b6c2d0' : '#526071'),
      rule:       isDark ? '#43556d' : '#8aa0b6',
      grid:       getComputedStyle(document.documentElement).getPropertyValue('--grid').trim() || (isDark ? '#263449' : '#e5e9ef'),
      rail:       getComputedStyle(document.documentElement).getPropertyValue('--rail').trim() || '#0b5fff',
      bus:        getComputedStyle(document.documentElement).getPropertyValue('--bus').trim() || '#16a34a',
      tram:       getComputedStyle(document.documentElement).getPropertyValue('--tram').trim() || '#f59e0b',
      ferry:      getComputedStyle(document.documentElement).getPropertyValue('--ferry').trim() || '#14b8a6',
      accent:     getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#7c3aed',
      water:      getComputedStyle(document.documentElement).getPropertyValue('--ocean').trim() || (isDark ? '#0b2233' : '#e6f0f8')
    };

    const vlTheme = {
      background: null,
      view: { stroke: null },
      axis: {
        labelColor: ui.text,
        titleColor: ui.text,
        gridColor: ui.grid,
        domainColor: ui.rule,
        tickColor: ui.rule
      },
      legend: { labelColor: ui.text, titleColor: ui.text },
      mark: { color: ui.rail },
      range: {
        category: [ui.rail, ui.bus, ui.tram, ui.ferry, ui.accent, "#60a5fa", "#34d399", "#fde047"]
      }
    };

    async function draw(id, url){
      const res = await fetch(url);
      if(!res.ok){ throw new Error(`Failed to load ${url}`); }
      const spec = await res.json();
      spec.config = Object.assign({}, spec.config||{}, vlTheme);
      await vegaEmbed(id, spec, {actions:false});
    }

    // Specs (JSON in /spec)
    draw("#vis-lollipop","spec/lollipop.json");
    draw("#vis-diverge","spec/diverge.json");
    draw("#vis-map","spec/au-pt-map.json");
    draw("#vis-waffles","spec/waffles.json");
    draw("#vis-pie","spec/pie.json");
    draw("#vis-scatter","spec/scatter.json");
    draw("#vis-infra","spec/infra-bars.json");
    draw("#vis-vic-lines","spec/vic-lines.json");
    draw("#vis-sa-stacked","spec/sa-stacked.json");
    draw("#vis-sa-heat","spec/sa-heat.json");

    document.getElementById("updated").textContent =
      new Date().toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
  </script>
</body>
</html>
